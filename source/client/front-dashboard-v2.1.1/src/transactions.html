<!DOCTYPE html>
<html lang="@@languageDirection.lang">
<head>
  <!-- Required Meta Tags Always Come First -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Title -->
  <title>은행거래내역</title>

  <!-- Favicon -->
  <link rel="shortcut icon" href="@@autopath/favicon.ico">

  <!-- Font -->
  <link href="@@vars.themeFont" rel="stylesheet">

  <!-- CSS Implementing Plugins -->
  <!-- bundlecss:vendor [@@autopath] -->
  <link rel="stylesheet" href="@@autopath/node_modules/bootstrap-icons/font/bootstrap-icons.css">
  @@if(layoutBuilder.header.layoutMode !== 'default') {
    <link rel="stylesheet" href="@@autopath/assets/vendor/hs-mega-menu/dist/hs-mega-menu.min.css">
  }
  <link rel="stylesheet" href="@@autopath/node_modules/tom-select/dist/css/tom-select.bootstrap5.css">

  <!-- CSS Front Template -->
  <!-- bundlecss:theme [@@autopath] @@vars.version -->
  @@if(layoutBuilder.extend.switcherSupport === false) {
    <link rel="stylesheet" href="@@autopath/assets/css/theme@@if(themeAppearance.layoutSkin === 'dark'){-dark}.css">
  }

  @@if(layoutBuilder.extend.switcherSupport === true) {
    <link rel="preload" href="@@autopath/assets/css/theme.css" data-hs-appearance="default" as="style">
    <link rel="preload" href="@@autopath/assets/css/theme-dark.css" data-hs-appearance="dark" as="style">

    <style data-hs-appearance-onload-styles>
        * {
            transition: unset !important;
        }

        body {
            opacity: 0;
        }
    </style>
  }

  <!-- plugin CSS -->
  <!-- <link rel="stylesheet" href="@@autopath/node_modules/daterangepicker/daterangepicker.css"> -->
  <link rel="stylesheet" href="@@autopath/node_modules/flatpickr/dist/flatpickr.min.css">

</head>

<body class="@@if(layoutBuilder.header.layoutMode === 'default'){has-navbar-vertical-aside navbar-vertical-aside-show-xl} @@if(layoutBuilder.sidebarLayout === 'compact'){navbar-vertical-aside-compact-mode navbar-vertical-aside-compact-mini-mode} @@if(layoutBuilder.sidebarLayout === 'mini'){navbar-vertical-aside-mini-mode} footer-offset">
    @@if(layoutBuilder.extend.switcherSupport === true) {
    <script src="@@autopath/assets/js/hs.theme-appearance.js"></script>
  }

    @@if(layoutBuilder.sidebarLayout !== 'compact' && layoutBuilder.sidebarLayout !== 'mini') {
    <script src="@@autopath/assets/vendor/hs-navbar-vertical-aside/dist/hs-navbar-vertical-aside-mini-cache.js"></script>
  }

  <!-- ========== HEADER ========== -->
  @@if(layoutBuilder.header.layoutMode === 'default') {
    @@include("@@autopath/partials/navbar/main.html")
  }

  @@if(layoutBuilder.header.layoutMode === 'single') {
    @@if(layoutBuilder.header.containerMode === 'container') {
      @@include("@@autopath/partials/navbar/main-container.html")
    }
  }

  @@if(layoutBuilder.header.layoutMode === 'double') {
    @@if(layoutBuilder.header.containerMode === 'container') {
      @@include("@@autopath/partials/navbar/double-line-container.html")
    }
  }
  <!-- ========== END HEADER ========== -->

  <!-- ========== MAIN CONTENT ========== -->
  <!-- Navbar Vertical -->
  @@if(layoutBuilder.sidebarLayout !== 'compact' && layoutBuilder.header.layoutMode === 'default') {
    @@include("@@autopath/partials/sidebar/main.html", {
      "category": "transactions",
      "subcategory": "",
      "link": "transactions.html"
    })
  }

  @@if(layoutBuilder.sidebarLayout === 'compact' && layoutBuilder.header.layoutMode === 'default') {
    @@include("@@autopath/partials/sidebar/compact.html", {
      "category": "transactions",
      "subcategory": "",
      "link": "transactions.html"
    })
  }

  <main id="content" role="main" class="main">
    <!-- Content -->
    <div class="content @@layoutBuilder.header.containerMode">
      <!-- Page Header -->
      <div class="page-header">
        <div class="row align-items-end">
          <div class="col-sm mb-2 mb-sm-0">
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb breadcrumb-no-gutter">
                <li class="breadcrumb-item"><a class="breadcrumb-link" href="javascript:;">Pages</a></li>
                <li class="breadcrumb-item"><a class="breadcrumb-link" href="javascript:;">은행거래내역</a></li>
                <li class="breadcrumb-item active" aria-current="page">전체내역</li>
              </ol>
            </nav>

            <h1 class="page-header-title">전체내역<span class="ml-5"><small class="ml-5 text-muted">All transactions</small></span></h1>
            
          </div>
          <!-- End Col -->

        </div>
        <!-- End Row -->
      </div>
      <!-- End Page Header -->

      <!-- Card -->
      <div class="card">
        <!-- Header -->
        <div class="card-header card-header-content-md-between">
          <h3>거래내역</h3>
          <!-- Search -->
          <div class="mb-2 mb-md-0">
            <form>
              <div class="input-group input-group-merge input-group-flush">
                <div class="input-group-prepend input-group-text">
                  <i class="bi-search"></i>
                </div>
                <input id="datatableSearch" type="search" class="form-control" placeholder="거래내역 검색">
              </div>
            </form>
          </div>
          <!-- End Search -->

          <!-- Pagination Quantity -->
          <span class="me-1">검색결과:&nbsp;<span id="datatableWithPaginationInfoTotalQty" class="text-info me-1"></span>건</span>
          <!-- End Pagination Quantity -->

          <div class="d-grid d-sm-flex justify-content-md-end align-items-sm-center gap-2">
            <!-- Date range -->
            <div class="row">
              <div class="col-sm-12 text-center">
                <!-- Flatpickr -->
                <input type="text" class="js-flatpickr form-control flatpickr-custom" placeholder="검색기간"
                       id="range_date"
                       data-hs-flatpickr-options='{
                   "dateFormat": "Y-m-d",
                   "mode": "range",
                   "locale": "ko"
                 }'>
                <!-- End Flatpickr -->
              </div>
            </div>
            <!-- End Date range -->

            <!-- Decade -->
            <div class="row">
              <div class="col-sm-12 text-center">
                <!-- <h4 class="bg-primary text-white p-2" style="margin: 15px;">(AlbumViewSet) Full example with foreign key and many to many relation</h4> -->
                <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                  <input type="radio" class="btn-check" name="btnradio" id="btnyear0" autocomplete="off">
                  <label class="btn btn btn-soft-primary btn-sm btn-decade" for="btnyear0">전체기간</label>
                  <input type="radio" class="btn-check" name="btnradio" id="btnyear1" autocomplete="off">
                  <label class="btn btn btn-soft-primary btn-sm btn-decade" for="btnyear1" rel="2020">2020년</label>
                  <input type="radio" class="btn-check" name="btnradio" id="btnyear2" autocomplete="off">
                  <label class="btn btn btn-soft-primary btn-sm btn-decade" for="btnyear2" rel="2021">2021년</label>
                  <input type="radio" class="btn-check" name="btnradio" id="btnyear3" autocomplete="off"]>
                  <label class="btn btn btn-soft-primary btn-sm btn-decade" for="btnyear3" rel="2022">2022년</label>
                  <input type="radio" class="btn-check" name="btnradio" id="btnyear4" autocomplete="off" checked>
                  <label class="btn btn btn-soft-primary btn-sm btn-decade" for="btnyear4" rel="2023">2023년</label>
                </div>
              </div>
            </div>
            <!-- End Decade -->

            <!-- Datatable Info -->
            <!-- <div id="datatableCounterInfo" style="display: none;"> -->
            <!-- <div id="datatableCounterInfo">
              <div class="d-flex align-items-center">
                <span class="fs-5 me-3">
                  <span id="datatableCounter">0</span>
                  Selected
                </span>
                <a class="btn btn-outline-danger btn-sm" href="javascript:;">
                  <i class="bi-trash"></i> Delete
                </a>
              </div>
            </div> -->
            <!-- End Datatable Info -->

            <!-- Dropdown -->
            <div class="dropdown">
              <button type="button" class="btn btn-white btn-sm dropdown-toggle w-100" id="usersExportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi-download me-2"></i> Export
              </button>

              <div class="dropdown-menu dropdown-menu-sm-end" aria-labelledby="usersExportDropdown">
                <span class="dropdown-header">Options</span>
                <a id="export-copy" class="dropdown-item" href="javascript:;">
                  <img class="avatar avatar-xss avatar-4x3 me-2" src="@@autopath/assets/svg/illustrations/copy-icon.svg" alt="Image Description">
                  Copy
                </a>
                <a id="export-print" class="dropdown-item" href="javascript:;">
                  <img class="avatar avatar-xss avatar-4x3 me-2" src="@@autopath/assets/svg/illustrations/print-icon.svg" alt="Image Description">
                  Print
                </a>
                <div class="dropdown-divider"></div>
                <span class="dropdown-header">Download options</span>
                <!-- <a id="export-excel" class="dropdown-item" href="javascript:;">
                  <img class="avatar avatar-xss avatar-4x3 me-2" src="@@autopath/assets/svg/brands/excel-icon.svg" alt="Image Description">
                  Excel
                </a> -->
                <a id="export-csv" class="dropdown-item" href="javascript:;">
                  <img class="avatar avatar-xss avatar-4x3 me-2" src="@@autopath/assets/svg/components/placeholder-csv-format.svg" alt="Image Description">
                  .CSV
                </a>
                <!-- <a id="export-pdf" class="dropdown-item" href="javascript:;">
                  <img class="avatar avatar-xss avatar-4x3 me-2" src="@@autopath/assets/svg/brands/pdf-icon.svg" alt="Image Description">
                  PDF
                </a> -->
              </div>
            </div>
            <!-- End Dropdown -->
          </div>
        </div>
        <!-- End Header -->

        <!-- <div class="d-flex justify-content-center" id="processingIndicator">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div> -->

        <!-- Table -->
        <div class="table-responsive datatable-custom position-relative">
          <table id="datatable" class="table table-sm table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                 data-hs-datatables-options='{
                    "info": {
                      "totalQty": "#datatableWithPaginationInfoTotalQty"
                    },
                    "search": "#datatableSearch",
                    "entries": "#datatableEntries",
                    "pageLength": 10,
                    "isResponsive": false,
                    "isShowPaging": false,
                    "pagination": "datatablePagination"
                 }'>
            <thead class="thead-light">
              <tr>
                <th>은행</th>   <!-- 0  -->
                <th>거래시각</th>
                <th>계정</th>
                <th>송수신인</th>
                <th>메모</th>   <!-- 4  -->
                <th>적요</th>
                <th>출금</th>   
                <th>입금</th>
                <th>잔액</th>   <!-- 8  -->
                <!-- <th>은행</th>
                <th>계좌명</th>
                <th>계좌번호</th> -->
                <th>처리점</th>
                <!-- <th>세부정보</th> -->
                <th>순번</th>
                <th>pk</th>
                <th>거래ID</th>     <!-- 12  -->
              </tr>
            </thead>
            <tbody>
            </tbody>
            <tfoot class="tfoot-light">
              <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <!-- <th>은행</th>
                <th>계좌명</th>
                <th>계좌번호</th> -->
                <th></th>
                <!-- <th>세부정보</th> -->
                <th></th>
                <th></th>
                <th></th>
              </tr>
            </tfoot>
          </table>
        </div>
        <!-- End Table -->

        <!-- Footer -->
        <div class="card-footer">
          <div class="row justify-content-center justify-content-sm-between align-items-sm-center">
            <div class="col-sm mb-2 mb-sm-0">
              <div class="d-flex justify-content-center justify-content-sm-start align-items-center">
                <span class="me-2">한번에 볼 거래 수</span>

                <!-- Select -->
                <div class="tom-select-custom w-25">
                  <select id="datatableEntries" class="js-select form-select form-select-borderless w-100" autocomplete="off"
                          data-hs-tom-select-options='{
                            "searchInDropdown": false,
                            "hideSearch": true
                          }'>
                    <option value="5">5</option>
                    <option value="10" selected>10</option>
                    <option value="15">15</option>
                    <option value="20">20</option>
                  </select>
                </div>
                <!-- End Select -->

                <!-- <span class="text-secondary me-2">of</span> -->

              </div>
            </div>
            <!-- End Col -->

            <div class="col-sm-auto">
              <div class="d-flex justify-content-center justify-content-sm-end">
                <!-- Pagination -->
                <nav id="datatablePagination" aria-label="Activity pagination"></nav>
              </div>
            </div>
            <!-- End Col -->
          </div>
          <!-- End Row -->
        </div>
        <!-- End Footer -->
      </div>
      <!-- End Card -->

      <!-- 입출금 총계 -->
      <div class="card mt-5">
        <div class="card-header card-header-content-md-between">
          <div class="row justify-content-between align-items-center">
            <div class="col">
              <h3>입출금 전체 총계</h3>
            </div>
            <div class="col-auto">
              <div class="d-flex justify-content-end"><small
                  class="ml-5 text-muted transactionstat-period">test</small></div>
            </div>
          </div>
        </div>

        <!-- HSCounter : buggy -->
        <div class="row px-3">
          <div class="col-sm-6 col-lg-4 mb-3 mb-lg-5">
            <!-- Card -->
            <div class="card h-100">
              <div class="card-body">
                <h6 class="card-subtitle mb-2 text-end">출금</h6>

                <div class="row align-items-center gx-2">
                  <div class="col text-end">
                    <span class="display-4 digit-withdraw" id="sum_withdraw"
                      data-hs-counter-options='{"isCommaSeparated": true, "isReduceThousandsTo": true}'>0</span>
                    <span class="text-body fs-5 ms-1">원</span>
                  </div>

                  <!-- <div class="col-auto">
                    <span class="badge bg-soft-success text-success p-1">
                      <i class="bi-graph-up"></i> 1.2%
                    </span>
                  </div> -->
                </div>
                <!-- End Row -->
              </div>
            </div>
            <!-- End Card -->
          </div>

          <div class="col-sm-6 col-lg-4 mb-3 mb-lg-5">
            <!-- Card -->
            <div class="card h-100">
              <div class="card-body">
                <h6 class="card-subtitle mb-2 text-end">입금</h6>

                <div class="row align-items-center gx-2">
                  <div class="col text-end">
                    <span class="display-4 digit-saving" id="sum_saving"
                      data-hs-counter-options='{"isCommaSeparated": true, "isReduceThousandsTo": true}'>0</span>
                    <!-- <span class="display-4 text-dark">%</span> -->
                    <span class="text-body fs-5 ms-1">원</span>
                  </div>

                  <!-- <div class="col-auto">
                    <span class="badge bg-soft-danger text-danger p-1">
                      <i class="bi-graph-down"></i> 2.8%
                    </span>
                  </div> -->
                </div>
                <!-- End Row -->
              </div>
            </div>
            <!-- End Card -->
          </div>

          <div class="col-sm-6 col-lg-4 mb-3 mb-lg-5">
            <!-- Card -->
            <div class="card h-100">
              <div class="card-body">
                <h6 class="card-subtitle mb-2 text-end">이익</h6>

                <div class="row align-items-center gx-2">
                  <div class="col text-end">
                    <span class="display-4 " id="sum_profit"
                      data-hs-counter-options='{"isCommaSeparated": true, "isReduceThousandsTo": true}'></span>
                    <!-- <span class="display-4 text-dark">%</span> -->
                    <span class="text-body fs-5 ms-1">원</span>
                  </div>

                  <!-- <div class="col-auto">
                    <span class="badge bg-soft-secondary text-secondary p-1">0.0%</span>
                  </div> -->
                </div>
                <!-- End Row -->
              </div>
            </div>
            <!-- End Card -->
          </div>
        </div>
        <!-- End HSCounter -->
      </div>
      <!-- End 입출금 총계 -->

      <!-- 계좌별 입출금 총계 -->
      <div class="card">
        <!-- Header -->
        <div class="card-header card-header-content-md-between">
          <div class="row justify-content-between align-items-center">
            <div class="col">
              <h3>계좌별 입출금 총계</h3>
            </div>
            <div class="col-auto">
              <div class="d-flex justify-content-end"><small
                    class="ml-5 text-muted transactionstat-period">test</small></div>
            </div>
          </div>
        </div>
        <!-- Table -->
        <div class="table-responsive datatable-custom position-relative">
          <table id="datatablestat"
            class="table table-sm table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
            data-hs-datatables-options='{
            }'>
            <thead class="thead-light">
              <tr>
                <th>PK</th>
                <th>은행</th>
                <th>출금</th>
                <th>입금</th>
                <th>이익</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
            <tfoot class="tfoot-light">
              <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
              </tr>
            </tfoot>
          </table>
        </div>
        <!-- End Table -->
      </div>
      <!-- End 계좌별 입출금 총계 -->
    </div>
    <!-- End Content -->

    <!-- Footer -->
    @@if(layoutBuilder.header.containerMode === 'container-fluid') {
      @@include("@@autopath/partials/footer/main.html")
    }

    @@if(layoutBuilder.header.containerMode === 'container') {
      @@include("@@autopath/partials/footer/container.html")
    }
    <!-- End Footer -->
  </main>
  <!-- ========== END MAIN CONTENT ========== -->

  <!-- ========== SECONDARY CONTENTS ========== -->
  <!-- Keyboard Shortcuts -->
  @@include("@@autopath/partials/layouts-components/offcanvas-shortcuts.html")
  <!-- End Keyboard Shortcuts -->

  <!-- Activity -->
  @@include("@@autopath/partials/layouts-components/offcanvas-activity.html")
  <!-- End Activity -->

  <!-- Welcome Message Modal -->
  @@include("@@autopath/partials/modals/welcome-message.html")
  <!-- End Welcome Message Modal -->

  <!-- Edit user -->
  @@include("@@autopath/partials/modals/edit-user.html")
  <!-- End Edit user -->
  <!-- ========== END SECONDARY CONTENTS ========== -->

  <!-- JS Global Compulsory @@deleteLine:build -->
  <script src="@@autopath/node_modules/jquery/dist/jquery.min.js"></script>
  <script src="@@autopath/node_modules/jquery-migrate/dist/jquery-migrate.min.js"></script>
  <script src="@@autopath/node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JS Implementing Plugins -->
  <!-- bundlejs:vendor [@@autopath] -->
  <script src="@@autopath/assets/vendor/hs-navbar-vertical-aside/dist/hs-navbar-vertical-aside.min.js"></script>
  <script src="@@autopath/assets/vendor/hs-form-search/dist/hs-form-search.min.js"></script>
  @@if(layoutBuilder.header.layoutMode !== 'default') {
    <script src="@@autopath/assets/vendor/hs-mega-menu/dist/hs-mega-menu.min.js"></script>
  }
  <script src="@@autopath/assets/vendor/hs-toggle-password/dist/js/hs-toggle-password.js"></script>
  <script src="@@autopath/assets/vendor/hs-file-attach/dist/hs-file-attach.min.js"></script>
  <script src="@@autopath/assets/vendor/hs-nav-scroller/dist/hs-nav-scroller.min.js"></script>
  <script src="@@autopath/assets/vendor/hs-step-form/dist/hs-step-form.min.js"></script>
  <script src="@@autopath/assets/vendor/hs-counter/dist/hs-counter.min.js"></script>
  <script src="@@autopath/node_modules/appear/dist/appear.min.js"></script>
  <script src="@@autopath/node_modules/imask/dist/imask.min.js"></script>
  <script src="@@autopath/node_modules/tom-select/dist/js/tom-select.complete.min.js"></script>
  <script src="@@autopath/node_modules/datatables/media/js/jquery.dataTables.min.js"></script>
  <script src="@@autopath/assets/vendor/datatables.net.extensions/select/select.min.js"></script>
  <script src="@@autopath/node_modules/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
  <script src="@@autopath/node_modules/datatables.net-buttons/js/buttons.flash.min.js"></script>
  <script src="@@autopath/node_modules/jszip/dist/jszip.min.js"></script>
  <script src="@@autopath/node_modules/pdfmake/build/pdfmake.min.js"></script>
  <script src="@@autopath/node_modules/pdfmake/build/vfs_fonts.js"></script>
  <script src="@@autopath/node_modules/datatables.net-buttons/js/buttons.html5.min.js"></script>
  <script src="@@autopath/node_modules/datatables.net-buttons/js/buttons.print.min.js"></script>
  <script src="@@autopath/node_modules/datatables.net-buttons/js/buttons.colVis.min.js"></script>
  <script src="@@autopath/node_modules/daterangepicker/moment.min.js"></script>
  <script src="@@autopath/node_modules/flatpickr/dist/flatpickr.min.js"></script>
  <script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>

    <!-- JS Front -->
  <!-- bundlejs:theme [@@autopath] -->
  <script src="@@autopath/assets/js/hs.core.js"></script>
  <script src="@@autopath/assets/js/hs.bs-dropdown.js"></script>
  <script src="@@autopath/assets/js/hs.imask.js"></script>
  <script src="@@autopath/assets/js/hs.tom-select.js"></script>
  <script src="@@autopath/assets/js/hs.datatables.js"></script>
  <script src="@@autopath/assets/js/hs.daterangepicker.js"></script>
  <script src="@@autopath/assets/js/hs.flatpickr.js"></script>


    <!-- JS Plugins Init. -->
  <script>
    function convert_to_number(value) {
      return Intl.NumberFormat().format(parseInt(value));
    }

    var DateTime = luxon.DateTime;

    $(document).on('ready', function () {
      // 데이터테이블보다 먼저 초기화 되어야 한다.
      // localtime
      let min_date = window.localStorage.getItem('sjbook.transactions.min_date');
      let max_date = window.localStorage.getItem('sjbook.transactions.max_date');
      var default_min_date = (min_date) ? DateTime.fromISO(min_date) : DateTime.local().startOf('year');
      var default_max_date = (max_date) ? DateTime.fromISO(max_date) : DateTime.local().endOf('year');
      var restful_server_address = localStorage.getItem('sjbook.restful_server_address') ?
        localStorage.getItem('sjbook.restful_server_address') : 'http://10.8.0.1'

      // INITIALIZATION OF FLATPICKR
      // =======================================================
      // default date range
      //$('#range_date').val([default_min_date, default_max_date])
      HSCore.components.HSFlatpickr.init('.js-flatpickr')

      var flatpickr = HSCore.components.HSFlatpickr.getItem('range_date');
      flatpickr.setDate([default_min_date.toISO(), default_max_date.toISO()]);

      function get_dtParams(dtParms) {
        // local
        // sel_dates : JS Date()
        let sel_dates = flatpickr.selectedDates;
        if (sel_dates.length === 0) {
          dtParms.min_date = default_min_date;
          dtParms.max_date = default_max_date;
        } else if (sel_dates.length === 1) {
          dtParms.min_date = dtParms.max_date = DateTime.local(sel_dates[0]);
        } else {
          dtParms.min_date = DateTime.fromJSDate(sel_dates[0]);
          dtParms.max_date = DateTime.fromJSDate(sel_dates[1]);
        }
        // convert local to utc
        dtParms.min_date = dtParms.min_date.startOf('day').setZone('UTC').toISO()
        dtParms.max_date = dtParms.max_date.endOf('day').setZone('UTC').toISO()
        return dtParms
      }

        // INITIALIZATION OF DATATABLES
      // =======================================================
      HSCore.components.HSDatatables.init($('#datatable'), {
        dom: 'Brtip',
        serverSide: true,
        // 거래시각, 순번
        order: [[3, 'desc'], [10, 'desc']],
        // processing: true,
        // search: {
        //     return: true,
        // },
        // "language": {"searchPlaceholder": "regular expression"},
        ajax: {
          url: `${restful_server_address}/transaction/transactions.datatables`,
          // type: 'POST',
          data: function(dtParms){
            return get_dtParams(dtParms);
          }
        },
        footerCallback: function (row, data, start, end, display) {
          var api = this.api(), data;

          var calcTotal = function (col_index) {
              var col;
              col = api.column(col_index);
              const g_total = (col.data().length > 0) ? col.data().reduce((a, b) => a + b) : 0;
              // col = api.column(col_index, {page: 'current'});
              // const p_total = (col.data().length > 0) ? col.data().reduce((a, b) => a + b) : 0;
              $(col.footer()).html(`${Intl.NumberFormat().format(parseInt(g_total))}`);

              return g_total;
          }

          // quantity, rebate, total_price
          for (let i of [4, 5, 6]) {
              const total = calcTotal(i);
          }
        },
        columns: [
          { data: 'bank', name: 'bank.alias',
            render: function (data, type, row, meta) {
              let logo = null;
              if (data.bank_name.search(/^국민.*/g) >= 0)
                logo = 'KB_logo.png';
              else if (data.bank_name.search(/^농협.*/g) >= 0)
                logo = 'NH_logo.png';

              return `
                <div class="d-flex align-items-center" href="#">
                  <div class="avatar avatar-circle ">
                    <img height="30px;" src="../assets/svg/brands/${logo}" alt="Image Description">
                  </div>
                  <div class="ms-3">
                    <a class="btn btn-default" data-bs-toggle="collapse" href="#collapseDiv_${row.pk}" role="button">
                      <b>${data.alias}</b></a>
                    <div class="collapse" id="collapseDiv_${row.pk}">
                      <div class="card card-body">
                        <span class="d-block fs-5 text-body">${data.account_name ? data.account_name : "알수없음"}</span>
                        <span class="d-block fs-5 text-body">${data.account_number}</span>
                      </div>
                    </div>
                  </div>
                </div>`;
            }          
          },
          { data: 'datetime',
            render: function (data, type, row, meta) {
              return `<b>${DateTime.fromISO(data).setZone('Asia/Seoul').toFormat("yyyy-MM-dd HH:mm:ss")}</b>`;
            }
          },
          { data: 'faccount_category.norm_name', name: 'faccount_category.norm_name',
            render: function (data, type, row, meta) {
              return (data) ? `<b class="text-dark">${data.norm_name}</b>` : '<span class="text-muted"><i class="bi bi-pencil-square"></i> 편집</span>';
            }
          },
          { data: 'recipient',
            render: function (data, type, row, meta) {
              return (data) ? `<b class="text-dark">${data}</b>` : '<span class="text-muted"><i class="bi bi-pencil-square"></i> 편집</span>';
            }
          },
          { data: 'user_note' },
          { data: 'bank_note' },
          { data: 'withdraw',
            className: 'text-end', 
            render: function (data, type, row, meta) {
              return `<b class="digit-withdraw">${convert_to_number(data)}</b>`;
            }
          },
          { data: 'saving',
            className: 'text-end', 
            render: function (data, type, row, meta) {
              return `<b class="digit-saving">${convert_to_number(data)}</b>`;
            }
          },
          { data: 'balance',
            className: 'text-end', 
            render: function (data, type, row, meta) {
              return `<b class="digit-balance">${convert_to_number(data)}</b>`;
            }
          },

          // { data: 'bank_name', visible:false },
          // { data: 'bank_account_name', visible:false },
          // { data: 'bank_account_number', visible:false },
          { data: 'handler', visible:false },
          // { data: 'url', visible:false },
          { data: 'transaction_order' },
          { data: 'pk', visible:false },
          { data: 'transaction_id', visible:false },
        ],
        buttons: [
          {
            extend: 'copy',
            className: 'd-none'
          },
          // {
          //   extend: 'excel',
          //   className: 'd-none'
          // },
          {
            extend: 'csv',
            className: 'd-none'
          },
          // {
          //   extend: 'pdf',
          //   className: 'd-none'
          // },
          {
            extend: 'print',
            className: 'd-none'
          },
        ],
        // select: {
        //   style: 'multi',
        //   selector: 'td:first-child input[type="checkbox"]',
        //   classMap: {
        //     checkAll: '#datatableCheckAll',
        //     counter: '#datatableCounter',
        //     counterInfo: '#datatableCounterInfo'
        //   }
        // },
        // language: {
        //   zeroRecords: `<div class="text-center p-4">
        //       <img class="mb-3" src="@@autopath/assets/svg/illustrations/oc-error.svg" alt="Image Description" style="width: 10rem;" data-hs-theme-appearance="default">
        //       <img class="mb-3" src="@@autopath/assets/svg/illustrations-light/oc-error.svg" alt="Image Description" style="width: 10rem;" data-hs-theme-appearance="dark">
        //     <p class="mb-0">No data to show</p>
        //     </div>`
        // }
      })

      const datatable = HSCore.components.HSDatatables.getItem('datatable')

      $('#export-copy').click(function() {
        datatable.button('.buttons-copy').trigger()
      });

      $('#export-csv').click(function() {
        let dtParams = get_dtParams({});
        var jqxhr = $.ajax({
          url: restful_server_address + '/transaction/download/csv',
          data: {
            'min_date': dtParams.min_date,
            'max_date': dtParams.max_date,
          }});
        jqxhr.done(function(data){
          let disposition = jqxhr.getResponseHeader('content-disposition');
          let matches = /"([^"]*)"/.exec(disposition);
          let filename = (matches != null && matches[1] ? matches[1] : 'file.csv');
          let blob=new Blob([data]);
          let link=document.createElement('a');
          link.href=window.URL.createObjectURL(blob);
          link.download=filename;
          link.click();
        });
        jqxhr.fail(function( jqXHR, textStatus, errorThrown ) {
          let message = JSON.parse(jqXHR.responseText);
          window.alert(message);
        });
      });

      // https://javascript.info/fetch
      // document.querySelector('#export-excel').onclick=(event) => {
      //   let response = await fetch(restful_server_address + '/transaction/download/excel', {
      //     // credentials: "include"
      //     // type: 'cors'
      //   });
      //   if (!response.ok) {
      //     throw new Error(`HTTP error: ${response.status}`);
      //   }
      //   let blob = await response.blob();

      //   // Try to find out the filename from the content disposition `filename` value
      //   // var disposition = request.getResponseHeader('content-disposition');
      //   // var matches = /"([^"]*)"/.exec(disposition);
      //   // var filename = (matches != null && matches[1] ? matches[1] : 'file.pdf');
      //   var filename = 'file.xlsx'
      //   // The actual download
      //   var blob_data = new Blob([blob], { type: 'application/vnd.ms-excel' });
      //   var link = document.createElement('a');
      //   link.href = window.URL.createObjectURL(blob_data);
      //   link.download = filename;
      //   // document.body.appendChild(link);
      //   link.click();
      //   // document.body.removeChild(link);
      //   // .catch((error) => {
      //   //   window.alert(error);
      //   // });
      // };

      // $('#export-excel').click(function() {
      //   datatable.button('.buttons-excel').trigger()
      // });

      // $('#export-pdf').click(function() {
      //   datatable.button('.buttons-pdf').trigger()
      // });

      $('#export-print').click(function() {
        datatable.button('.buttons-print').trigger()
      });

      $('.btn-decade').on('click', function() {
        datatable.columns().search('');
        var rel = $(this).attr('rel');
        // if (!rel) {
        //   // datatable.columns(3).search('^' + rel + '.*$', true).draw();
        //   rel="2023";
        // } else {
        //   ;
        // }
        let start_date = DateTime.fromISO(`${rel ? rel : '2020'}-01-01`).startOf('year').setZone('Asia/Seoul');
        let end_date = rel ? start_date.endOf('year').endOf('day') : DateTime.now().endOf('day');
        flatpickr.setDate([start_date.toISO(), end_date.toISO()]);
        /*
        $('.js-daterangepicker-clear').data('daterangepicker').setStartDate(start_date);
        $('.js-daterangepicker-clear').data('daterangepicker').setEndDate(end_date);
        */
        datatable.draw();
      });

      // $('.js-datatable-filter').on('change', function() {
      //   var $this = $(this),
      //     elVal = $this.val(),
      //     targetColumnIndex = $this.data('target-column-index');

      //   if (elVal === 'null') elVal = ''

      //   datatable.column(targetColumnIndex).search(elVal).draw();
      // });

      // datatable.on('processing.dt', function (e, settings, processing) {
      //     $('#processingIndicator').css('display', 'none');
      //     if (processing) {
      //       $(e.currentTarget).LoadingOverlay("show");
      //     } else {
      //       $(e.currentTarget).LoadingOverlay("hide", true);
      //     }
      // });

      // $('.js-daterangepicker-clear').on('change', (event) => {
      //   if (datatable)
      //     datatable.draw();
      // });
      function update_stat(bank_stats) {
        /*
        (5) [{…}, {…}, {…}, {…}, {…}]
        0
        :
        {bank: 2, bank__alias: '국민환전', sum_withdraw: 0, sum_saving: 1050, sum_profit: 1050}
        1
        :
        {bank: 4, bank__alias: '농협스위칭 2021', sum_withdraw: 5999887, sum_saving: 12392731, sum_profit: 6392844}
        2
        :
        {bank: 5, bank__alias: '농협일반경비 2021', sum_withdraw: 67624141, sum_saving: 20000000, sum_profit: -47624141}
        3
        :
        {bank: 6, bank__alias: '농협관리 2203-2302', sum_withdraw: 200000000, sum_saving: 2309593, sum_profit: -197690407}
        4
        :
        {bank: 7, bank__alias: '농협원자재 2020', sum_withdraw: 148458000, sum_saving: 203010000, sum_profit: 54552000}
        length
        :
        5
        [[Prototype]]
        */
        let sum_saving=0, sum_withdraw=0, sum_profit=0;
        let stats = bank_stats.stat;
        for (let s of stats) {
          sum_saving += parseInt(s.sum_saving);
          sum_withdraw += parseInt(s.sum_withdraw);
          sum_profit += parseInt(s.sum_profit);
        }
        $('#sum_withdraw').text(convert_to_number(sum_withdraw));
        $('#sum_saving').text(convert_to_number(sum_saving));
        $('#sum_profit').text(convert_to_number(sum_profit));
        let elm = $('#sum_profit');
        if (sum_profit > 0) {
          elm.removeClass('text-danger');
          elm.addClass('text-primary');
        } else {
          elm.removeClass('text-primary');
          elm.addClass('text-danger');
        }
        let min_date_str = DateTime.fromISO(bank_stats.min_date).toISODate();
        let max_date_str = DateTime.fromISO(bank_stats.max_date).toISODate();

        let elms = document.querySelectorAll('.transactionstat-period')
        elms.forEach(e => e.innerText=`${min_date_str} ~ ${max_date_str}`)

        // $('#sum_withdraw').text(sum_withdraw);
        // $('#sum_saving').text(sum_saving);
        // $('#sum_profit').text(sum_profit);
      }

      HSCore.components.HSDatatables.init($('#datatablestat'), {
        // dom: 'Bfrtip',
        // serverSide: true,
        // processing: true,
        // search: {
        //     return: true,
        // },
        // "language": {"searchPlaceholder": "regular expression"},
        // ajax: {
        //   url: 'http://0.0.0.0:8000/transaction/stat',
        //   // type: 'POST',
        //   data: function(dtParms){
        //     s = $('.js-daterangepicker-clear').val().split('~')
        //     var min_date = s[0].trim();
        //     var max_date = s[1].trim();
        //     dtParms.min_date = min_date;
        //     dtParms.max_date = max_date;
        //     return dtParms
        //   }
        // },
        footerCallback: function (row, data, start, end, display) {
          var api = this.api(), data;

          var calcTotal = function (col_index, style) {
            var col;
            col = api.column(col_index);
            const g_total = (col.data().length > 0) ? col.data().reduce((a, b) => a + b) : 0;
            // col = api.column(col_index, {page: 'current'});
            // const p_total = (col.data().length > 0) ? col.data().reduce((a, b) => a + b) : 0;
            $(col.footer()).html(`<b class="${style}">${Intl.NumberFormat().format(parseInt(g_total))}</b>`);

            return g_total;
          }

          // quantity, rebate, total_price
          for (let i of [[2, 'digit-withdraw'], [3, 'digit-saving'], [4, 'digit-profit']]) {
            calcTotal(i[0], i[1]);
          }
        },
        columns : [
          {data: 'bank', visible:false},
          {data: 'bank__alias',
            render: function (data, type, row, meta) {
              let logo = null;
              if (data.search(/^국민.*/g) >= 0)
                logo = 'KB_logo.png';
              else if (data.search(/^농협.*/g) >= 0)
                logo = 'NH_logo.png';

              return `
                <div class="d-flex align-items-center" href="#">
                  <div class="avatar avatar-circle">
                    <img height="30px;" src="../assets/svg/brands/${logo}" alt="Image Description">
                  </div>
                  <div class="ms-3">
                    <b>${data}</b>
                  </div>
                </div>`;
            }
          },
          {data: 'sum_withdraw', className: 'text-end',
            render: function (data, type, row, meta) {
              return `<b class="digit-withdraw">${convert_to_number(data)}</b>`;
            }},
          {data: 'sum_saving', className: 'text-end',
            render: function (data, type, row, meta) {
              return `<b class="digit-saving">${convert_to_number(data)}</b>`;
            }},
          {data: 'sum_profit', className: 'text-end',
            render: function (data, type, row, meta) {
              return `<b class="digit-balance">${convert_to_number(data)}</b>`;
            }},
        ]
      });

      const datatablestat = HSCore.components.HSDatatables.getItem('datatablestat')

      $("#datatable").on('xhr.dt', function ( e, settings, json, xhr ) {
        // console.log(json)
        datatablestat.clear();
        datatablestat.rows.add(json.bank_stats.stat);
        datatablestat.draw();
        update_stat(json.bank_stats);
      });

      // https://flatpickr.js.org/events/#events
      flatpickr.config.onValueUpdate.push(function(selectedDates, dateStr, instance) {
        // selectedDates : array of JS Date() 
        let min_d = DateTime.fromJSDate(selectedDates[0]).startOf('day');
        window.localStorage.setItem('sjbook.transactions.min_date', min_d.toISO());
        if (selectedDates.length === 1)
          window.localStorage.setItem('sjbook.transactions.max_date', min_d.endOf('day').toISO());
        else
          window.localStorage.setItem('sjbook.transactions.max_date', DateTime.fromJSDate(selectedDates[1]).endOf('day').toISO());
        if (datatable) {
          datatable.draw();
        }
      });

      datatable.ajax.reload();
    });
  </script>


  <!-- JS Plugins Init. -->
  <script>
    (function() {
      window.onload = function () {
        @@if(layoutBuilder.header.layoutMode !== 'default') {
          // INITIALIZATION OF MEGA MENU
          // =======================================================
          new HSMegaMenu('.js-mega-menu', {
            desktop: {
              position: 'left'
            }
          })
        }

        // INITIALIZATION OF NAVBAR VERTICAL ASIDE
        // =======================================================
        new HSSideNav('.js-navbar-vertical-aside').init()


        // INITIALIZATION OF FORM SEARCH
        // =======================================================
        new HSFormSearch('.js-form-search')


        // INITIALIZATION OF BOOTSTRAP DROPDOWN
        // =======================================================
        HSBsDropdown.init()


        // INITIALIZATION OF SELECT
        // =======================================================
        HSCore.components.HSTomSelect.init('.js-select')


        // INITIALIZATION OF INPUT MASK
        // =======================================================
        HSCore.components.HSMask.init('.js-input-mask')


        // INITIALIZATION OF NAV SCROLLER
        // =======================================================
        new HsNavScroller('.js-nav-scroller')


        // INITIALIZATION OF COUNTER
        // =======================================================
        new HSCounter('.js-counter')


        // INITIALIZATION OF TOGGLE PASSWORD
        // =======================================================
        new HSTogglePassword('.js-toggle-password')


        // INITIALIZATION OF FILE ATTACHMENT
        // =======================================================
        new HSFileAttach('.js-file-attach')


      }
    })()
  </script>

  <!-- Style Switcher JS -->
  @@if(layoutBuilder.extend.switcherSupport === true) {
    @@include("@@autopath/partials/layouts-components/darkmode-switcher-js.html")
  }
  <!-- End Style Switcher JS -->
</body>
</html>
